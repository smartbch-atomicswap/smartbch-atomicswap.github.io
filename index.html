<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <button onclick="sendData">sendData</button>
    <script>
        if ('serviceWorker' in navigator) {
            // Register service worker
            navigator.serviceWorker.register('/index-serviceworker.js').then(function (reg) {
                console.log("SW registration succeeded. Scope is " + reg.scope);

                navigator.serviceWorker.addEventListener('message', function (event) {
                    console.log("event:", event, "Received Message: " + event.data);
                });

                const data = { action: "write", data: { privateKey: "privateKey" } }
                navigator.serviceWorker.controller.postMessage(data)
            }).catch(function (err) {
                console.error("SW registration failed with error " + err);
            });
        }

        function sendData() {
            const message = BigInt(Math.random() * 10000)
            const data = { [Math.random.toString()]: message }
            console.log("sendData:", data)
            navigator.serviceWorker.controller.postMessage({ action: "write", data })
        }

        function readData(key) {
            navigator.serviceWorker.controller.postMessage({ action: "read", key });
        }
    </script>
</body>

</html>